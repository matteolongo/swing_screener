# Swing Screener ‚Äî Operational Guide (CLI Workflows)

> **Status: Needs review.** CLI commands and flags may change; verify against `swing_screener.cli --help` and current docs.  
> **Last Reviewed:** February 17, 2026.

This document explains **how to use Swing Screener via command-line interface (CLI)** for:
- Automation and scripting
- Headless server environments
- Advanced users who prefer terminal workflows

---

## üåê Prefer the Web UI?

**Most users should use the Web UI instead.**

The modern browser-based interface provides:
- Visual portfolio dashboard
- Interactive screener with Create Order modal
- Position and order management with CRUD operations
- Real-time P&L calculations and risk validation

üëâ **See [WEB_UI_GUIDE.md](WEB_UI_GUIDE.md) for complete Web UI documentation**

---

## üíª CLI Workflows (This Guide)

This guide covers **CLI-only** operations for advanced use cases.

### When to use CLI:
- ‚úÖ Automation scripts (cron jobs, scheduled tasks)
- ‚úÖ Headless servers (no browser)
- ‚úÖ Batch operations (processing multiple files)
- ‚úÖ Integration with other tools (pipes, redirects)

### When to use Web UI instead:
- ‚ùå Daily interactive trading (use Web UI)
- ‚ùå Visual portfolio review (use Web UI Dashboard)
- ‚ùå Creating orders from screener (use Web UI Screener)
- ‚ùå Managing positions (use Web UI Positions page)

---

## What this README is (and is not)

### This file IS:
- a practical operating manual
- focused on real execution (Degiro-friendly)
- aligned with the CLI and notebooks you built
- meant to be followed mechanically

### This file is NOT:
- a replacement for `README.md`
- a replacement for `README_BEGINNER.md`
- a replacement for `README_technical.md`

üëâ **This is a new document. Do NOT replace existing READMEs.**

Recommended location:
```
docs/engineering/OPERATIONAL_GUIDE.md
```

---

## Mental model (important)

Swing Screener is split into **three responsibilities**:

1. **Screening** ‚Üí find new trade candidates
2. **Execution** ‚Üí place orders manually (Degiro)
3. **Management** ‚Üí update stops / exits on open positions

The software handles **(1) and (3)**.  
You handle **(2)**.

---

## Files you should care about

### 1) `data/positions.json`
Your **single source of truth** for open trades.

Contains:
- entry price
- stop loss
- shares
- trade state
Closed-trade fields (required when closing):
- `exit_date`
- `exit_price`
Optional linkage fields:
- `position_id`
- `source_order_id`
- `exit_order_ids` (stop/TP orders)

You update this file **only when you open or close trades**.

---

### 2) `data/orders.json`
Tracks **orders** (entry/stop/TP) and their status.

You update this file when you **place, cancel, or fill orders**.

Optional CLI helper (entry fill):

```bash
swing-screener orders fill --orders data/orders.json --positions data/positions.json \
  --order-id ORD-XYZ --fill-price 12.34 --fill-date 2026-02-02 \
  --quantity 5 --stop-price 11.80
```

Other CLI helpers:

```bash
swing-screener orders list --orders data/orders.json --status pending
swing-screener orders cancel --orders data/orders.json --order-id ORD-XYZ
```

---

### 3) `data/strategies.json`
All strategy definitions (including the default strategy).

### 4) `data/active_strategy.json`
Holds the currently active strategy id.

### 5) `out/report.csv`
Daily **new trade candidates**.

Generated by:
```bash
swing-screener run ...
```

---

### 6) `out/degiro_actions.md`
Daily **checklist for Degiro** (manage existing positions).

Generated by:
```bash
swing-screener manage ...
```

This is the most important operational output.

---

## Orders vs positions (important)

- `data/orders.json` tracks **entry/stop/TP orders** (status: pending/filled/cancelled).
- `data/positions.json` tracks **open positions** you currently hold.
- When an entry order is **filled**, it should create a position and link to it.
- Stop-loss and take-profit are separate **exit orders** linked to that position.

To backfill links (and optionally create missing stop orders):

```bash
swing-screener migrate --orders data/orders.json --positions data/positions.json --create-stop-orders
```

---

## Daily routine (Barcelona / CET)

### ‚è∞ When
**Every trading day after US market close**:

- Barcelona winter: ~22:15
- Barcelona summer: ~22:30

Never run during market hours.

---

## Step 1 ‚Äî Find new trade candidates

Run the screener:

```bash
swing-screener run --universe mega_all --positions data/positions.json --csv out/report.csv
```

To run a specific strategy (override active):
```bash
swing-screener run --universe mega_all --positions data/positions.json --strategy-id STRAT_ID --csv out/report.csv
```

This does:
- loads tickers automatically
- computes trend, momentum, volatility
- ranks candidates
- computes entry / stop / shares
- excludes open positions from new candidates
- applies the Social Overlay (if enabled) to reduce risk or flag manual review

### What you do next
- Open `out/report.csv`
- Look ONLY at rows with a valid `signal`
- Decide whether to take the trade

**Social Overlay (optional):**
- Adds columns like `overlay_status`, `overlay_reasons`, and `overlay_*` metrics
- Statuses include `OK`, `REDUCED_RISK`, `REVIEW`, `VETO`, `NO_DATA`
- The overlay never changes ranking in v1; it only adjusts risk or flags review

---

## Social overlay smoke test (CLI)

Use this to verify the Reddit provider returns data for well-known tickers:

```bash
swing-screener social-test --symbols TSLA NVDA AAPL GME --hours 24
```

Optional subreddit override:
```bash
swing-screener social-test --symbols TSLA NVDA --subreddits wallstreetbets stocks
```

## Social cache export (CLI)

Export cached social data for offline analysis:

```bash
swing-screener social-export --format parquet --scope both --out out/social
```

Options:
- `--format` = `parquet` or `csv` (default: `parquet`)
- `--scope` = `events`, `metrics`, or `both` (default: `both`)
- `--provider` = cache folder name (default: `reddit`)

No signal ‚Üí no trade.

### Execution Guidance Fields
The report now includes explicit execution hints for next-day orders:
- `entry` is NOT an order price; it is used for sizing and risk math only.
- Use `suggested_order_type`, `suggested_order_price`, and `execution_note` as the only execution guidance.
- `suggested_validity` is always `DAY`.
- If present, `order_price_band_low` / `order_price_band_high` show a limit-entry range.

---

## Step 2 ‚Äî Place orders in Degiro

For each trade you accept:

1. Place a **BUY order** (limit or market)
2. Place a **STOP LOSS order**
3. Confirm position size matches `shares`

‚ö†Ô∏è Do not:
- adjust position size emotionally
- widen the stop
- enter without a stop

### Scale-in (add to a winner)

If you add to an existing open position:
- Record the new entry as a pending order in `data/orders.json`.
- When it fills, choose **Scale-in** in the UI Orders tab.
- The system blends the entry price and shares, keeps the existing stop, and recomputes `initial_risk`.
- Scale-in logic is shared across UI and CLI utilities for consistent results.

CLI alternative:

```bash
swing-screener orders scale-in --orders data/orders.json --positions data/positions.json \
  --order-id ORD-XYZ --fill-price 12.34 --fill-date 2026-02-02 --quantity 5
```

---

## Step 3 ‚Äî Register the trade

Immediately update `data/positions.json`.

Example:

```json
{
  "ticker": "INTC",
  "status": "open",
  "entry_date": "2026-01-13",
  "entry_price": 47.29,
  "stop_price": 42.88,
  "shares": 1,
  "notes": "breakout"
}
```

If it‚Äôs not in `data/positions.json`, it does not exist.

---

## Step 4 ‚Äî Manage existing positions (every day)

Run:

```bash
swing-screener manage --positions data/positions.json --md out/degiro_actions.md
```

To manage with a specific strategy (override active):
```bash
swing-screener manage --positions data/positions.json --strategy-id STRAT_ID --md out/degiro_actions.md
```

This:
- reloads open positions
- recalculates R-multiples
- suggests stop updates or exits
- produces a **Degiro-ready checklist**

Open:
```
out/degiro_actions.md
```

Follow it line by line.

---

## Step 5 ‚Äî Apply stop updates (optional but recommended)

If you want the software to keep your local state in sync:

```bash
swing-screener manage --positions data/positions.json --apply --md out/degiro_actions.md
```

This:
- updates stop prices in `data/positions.json`
- NEVER lowers a stop
- only applies `MOVE_STOP_UP` actions

Degiro execution remains manual.

---

## Building and curating universes (new)

You can now inspect, filter, and save universes via CLI:

- **List packaged universes**
  ```bash
  swing-screener universes list
  ```
  Examples include `mega_all`, `mega_stocks`, `core_etfs`, `defense_all`, `healthcare_all`, `europe_large`, `amsterdam_aex`, `amsterdam_all`, `amsterdam_amx`.
  Note: named universes can specify a default benchmark (e.g., `europe_large` ‚Üí `VGK`, `amsterdam_*` ‚Üí `VGK`). When you pass `--universe`, that benchmark is used for momentum/RS and regime checks.
- **Preview with filters (include/exclude/grep)**
  ```bash
  swing-screener universes show --name mega_all --top 20 --grep A --exclude AAPL
  ```
- **Filter and save to a CSV** (reusable with `--universe-file`)
  ```bash
  swing-screener universes filter --name mega_all --grep X --out data/universes/custom_x.csv
  ```
  Options:
  - `--include / --exclude` literal tickers
  - `--grep` substring match (case-insensitive)
  - `--benchmark`/`--no-benchmark` to keep or drop the benchmark
  - `--max` to cap length after filtering

Saved CSVs are plain newline-separated tickers and can be referenced with:
```bash
swing-screener run --universe-file data/universes/custom_x.csv --positions data/positions.json
```

---

## How exits work (very important)

A position can be closed because:

1. **Stop loss hit**
2. **Time exit**
3. **Trend breakdown (via trailing stop)**

The system will tell you:
```
CLOSE_STOP_HIT
CLOSE_TIME_EXIT
```

When you close a trade in Degiro:
- mark it as `status: closed` in `data/positions.json`
- include `exit_date` and `exit_price`
- or remove it entirely

---

## What NOT to do

- Do NOT run intraday
- Do NOT move stops down
- Do NOT override signals emotionally
- Do NOT change rules mid-trade

This system works because it is boring.

---

## Weekly routine (10 minutes)

Once per week:
- review closed trades
- check if rules were followed
- do NOT tweak parameters

---

## Monthly routine (optional)

- review performance metrics
- adjust parameters **only if necessary**
- document changes

---

## Final note

If you follow this guide:
- decisions are consistent
- workload is minimal
- emotions are reduced

Swing Screener is not about being right.
It is about being **systematic**.

---

_End of operational guide_
